{
    # Global options
    servers {
        max_header_size 16KB
        timeouts {
            read_body 30s
            read_header 30s
            write 30s
            idle 120s
        }
    }
}

processsutra.com www.processsutra.com {
    # Enable compression
    encode zstd gzip
    
    # Reverse proxy with optimizations
    reverse_proxy 127.0.0.1:5000 {
        # Load balancing
        lb_policy round_robin
        
        # Increase connection limits
        transport http {
            # Keep connections alive
            keepalive 120s
            keepalive_idle_conns 100
            max_conns_per_host 0
            
            # Timeouts
            dial_timeout 10s
            response_header_timeout 30s
        }
        
        # Health check
        health_uri /api/health
        health_interval 30s
        health_timeout 10s
        
        # Headers
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        X-XSS-Protection 1; mode=block
        -Server
    }
    
    # Cache static assets
    @static {
        path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2
    }
    header @static Cache-Control public, max-age=31536000
    
    # Logging
    log {
        output file /var/log/caddy/access.log {
            roll_size 100mb
            roll_keep 5
        }
    }
}

194.238.16.140 {
    redir https://processsutra.com{uri} permanent
}
