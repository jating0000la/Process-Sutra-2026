{
    servers {
        max_header_size 16KB
        timeouts {
            read_body 30s
            write 60s
            idle 300s
        }
    }
}

processsutra.com, www.processsutra.com {
    encode gzip

    reverse_proxy localhost:5000 {
        # Load balancing for high traffic
        lb_policy round_robin
        lb_try_duration 5s
        
        # Connection pooling for 8000+ users
        transport http {
            keepalive 300s
            keepalive_idle_conns 500
            max_conns_per_host 0
            dial_timeout 10s
            response_header_timeout 60s
        }

        # Headers
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        
        # Health check
        health_uri /api/health
        health_interval 30s
        health_timeout 10s
    }

    # Rate limiting (optional - adjust as needed)
    # rate_limit {
    #     zone dynamic {
    #         key {remote_host}
    #         events 100
    #         window 1m
    #     }
    # }

    log {
        output file /var/log/caddy/access.log {
            roll_size 100MB
            roll_keep 5
        }
    }
}

http://194.238.16.140 {
    redir https://processsutra.com{uri} permanent
}
